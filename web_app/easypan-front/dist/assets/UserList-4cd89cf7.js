import{j as K,r as d,ag as l,o as k,c as w,a as m,V as e,P as a,a3 as z,a9 as P,T as f,U as b,u as V,S as C,n as E}from"./@vue-7298a6f3.js";import{u as H,b as G}from"./vue-router-128bc7ad.js";import{_ as J}from"./index-29e2e257.js";import"./element-plus-857d32b3.js";import"./lodash-es-36eb724a.js";import"./@vueuse-740eda15.js";import"./@element-plus-925c7e21.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-c95324ad.js";import"./aplayer-d80f7f58.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-85da7166.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-d10d3e5d.js";import"./vue-cookies-9b55b892.js";import"./@highlightjs-b388fc70.js";import"./highlight.js-cc51af62.js";import"./axios-4a70c6fc.js";import"./docx-preview-b41ea745.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-acd0b5a4.js";import"./vue-9ac0364e.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const Q={class:"top-panel"},W={class:"file-list"},X={class:"avatar"},Y={key:0,style:{color:"#529b2e"}},Z={key:1,style:{color:"#f56c6c"}},ee=["onClick"],te=["onClick"],ae={__name:"UserList",setup(se){const{proxy:n}=K();H(),G();const g={loadDataList:"/admin/loadUserList",updateUserStatus:"/admin/updateUserStatus",updateUserSpace:"/admin/updateUserSpace"},N=[{label:"Avatar",prop:"avatar",width:80,scopedSlots:"avatar"},{label:"nickName",prop:"nickName"},{label:"email",prop:"email"},{label:"storage usage",prop:"space",scopedSlots:"space"},{label:"join time",prop:"joinTime"},{label:"last login time",prop:"lastLoginTime"},{label:"status",prop:"status",scopedSlots:"status",width:80},{label:"operation",prop:"op",width:150,scopedSlots:"op"}],r=d({}),_=d({}),D={extHeight:20},c=async()=>{let s={pageNo:_.value.pageNo,pageSize:_.value.pageSize};Object.assign(s,r.value);let t=await n.Request({url:g.loadDataList,params:s});t&&(_.value=t.data)},L=s=>{n.Confirm(`you really want to【${s.status==0?"active":"disabled"}】？`,async()=>{await n.Request({url:g.updateUserStatus,params:{userId:s.userId,status:s.status==0?1:0}})&&c()})},u=d({show:!1,title:"change storage size",buttons:[{type:"primary",text:"yes",click:s=>{T()}}]}),p=d({}),h=d(),I={changeSpace:[{required:!0,message:"please write storage size"}]},R=s=>{u.value.show=!0,E(()=>{h.value.resetFields(),p.value=Object.assign({},s)})},T=()=>{h.value.validate(async s=>{if(!s)return;let t={};Object.assign(t,p.value),await n.Request({url:g.updateUserSpace,params:t})&&(u.value.show=!1,n.Message.success("operation success"),c())})};return(s,t)=>{const S=l("el-input"),v=l("el-form-item"),y=l("el-col"),x=l("el-option"),j=l("el-select"),q=l("el-button"),F=l("el-row"),U=l("el-form"),A=l("Avatar"),B=l("el-divider"),M=l("Table"),O=l("Dialog");return k(),w("div",null,[m("div",Q,[e(U,{model:r.value,"label-width":"80px",onSubmit:t[2]||(t[2]=z(()=>{},["prevent"]))},{default:a(()=>[e(F,null,{default:a(()=>[e(y,{span:4},{default:a(()=>[e(v,{label:"user nickName"},{default:a(()=>[e(S,{clearable:"",placeholder:"support fuzzy search",modelValue:r.value.nickNameFuzzy,"onUpdate:modelValue":t[0]||(t[0]=i=>r.value.nickNameFuzzy=i),modelModifiers:{trim:!0},onKeyup:P(c,["native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),e(y,{span:4},{default:a(()=>[e(v,{label:"status"},{default:a(()=>[e(j,{clearable:"",placeholder:"please choose status",modelValue:r.value.status,"onUpdate:modelValue":t[1]||(t[1]=i=>r.value.status=i)},{default:a(()=>[e(x,{value:1,label:"active"}),e(x,{value:0,label:"disabled"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(y,{span:4,style:{"padding-left":"10px"}},{default:a(()=>[e(q,{type:"primary",onClick:c},{default:a(()=>[f(" search ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),m("div",W,[e(M,{columns:N,showPagination:!0,dataSource:_.value,fetch:c,options:D},{avatar:a(({index:i,row:o})=>[m("div",X,[e(A,{userId:o.userId,avatar:o.qqAvatar},null,8,["userId","avatar"])])]),space:a(({index:i,row:o})=>[f(b(V(n).Utils.size2Str(o.useSpace))+"/"+b(V(n).Utils.size2Str(o.totalSpace)),1)]),status:a(({index:i,row:o})=>[o.status==1?(k(),w("span",Y,"active")):C("",!0),o.status==0?(k(),w("span",Z,"disabled")):C("",!0)]),op:a(({index:i,row:o})=>[m("span",{class:"a-link",onClick:$=>R(o)},"assign storage size",8,ee),e(B,{direction:"vertical"}),m("span",{class:"a-link",onClick:$=>L(o)},b(o.status==0?"active":"disabled"),9,te)]),_:1},8,["dataSource"])]),e(O,{show:u.value.show,title:u.value.title,buttons:u.value.buttons,width:"400px",showCancel:!1,onClose:t[5]||(t[5]=i=>u.value.show=!1)},{default:a(()=>[e(U,{model:p.value,rules:I,ref_key:"formDataRef",ref:h,"label-width":"80px",onSubmit:t[4]||(t[4]=z(()=>{},["prevent"]))},{default:a(()=>[e(v,{label:"nickName"},{default:a(()=>[f(b(p.value.nickName),1)]),_:1}),e(v,{label:"storage size",prop:"changeSpace"},{default:a(()=>[e(S,{clearable:"",placeholder:"please write storage size",modelValue:p.value.changeSpace,"onUpdate:modelValue":t[3]||(t[3]=i=>p.value.changeSpace=i)},{suffix:a(()=>[f("MB")]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},Ie=J(ae,[["__scopeId","data-v-b82608ae"]]);export{Ie as default};
