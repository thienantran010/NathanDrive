import{j as Y,r,ag as f,o as a,c as s,a as l,V as m,P as h,a9 as z,T as R,O as C,F as V,S as n,U as S,J as H,u as J,bh as G,bf as Q}from"./@vue-7298a6f3.js";import{_ as W}from"./index-29e2e257.js";import"./element-plus-857d32b3.js";import"./lodash-es-36eb724a.js";import"./@vueuse-740eda15.js";import"./@element-plus-925c7e21.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-c95324ad.js";import"./aplayer-d80f7f58.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-85da7166.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-d10d3e5d.js";import"./vue-router-128bc7ad.js";import"./vue-cookies-9b55b892.js";import"./@highlightjs-b388fc70.js";import"./highlight.js-cc51af62.js";import"./axios-4a70c6fc.js";import"./docx-preview-b41ea745.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-acd0b5a4.js";import"./vue-9ac0364e.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const X=y=>(G("data-v-d065de28"),y=y(),Q(),y),Z={class:"top"},ee={class:"top-op"},te={class:"search-panel"},oe=X(()=>l("span",{class:"iconfont icon-del"},null,-1)),le={class:"file-list"},ae=["onMouseenter","onMouseleave"],ie=["title"],se=["onClick"],ne={key:0,class:"transfer-status"},ce={key:1,class:"transfer-status transfer-fail"},re={key:3,class:"edit-panel"},de=["onClick"],pe=["onClick"],ue={class:"op"},fe=["onClick"],me=["onClick"],_e={key:0},ve={__name:"FileList",setup(y){const{proxy:c}=Y(),_={loadDataList:"/admin/loadFileList",delFile:"/admin/delFile",createDownloadUrl:"/admin/createDownloadUrl",download:"/api/admin/download"},L=[{label:"FileName",prop:"fileName",scopedSlots:"fileName"},{label:"Owner",prop:"nickName",width:250},{label:"Modify Time",prop:"lastUpdateTime",width:200},{label:"Size",prop:"fileSize",scopedSlots:"fileSize",width:200}],w=()=>{k.value=!0,p()},v=r({}),U={extHeight:50,selectType:"checkbox"},d=r([]),x=t=>{d.value=[],t.forEach(o=>{d.value.push(o.userId+"_"+o.fileId)}),console.log(d)},g=r(),k=r(!0),p=async()=>{let t={pageNo:v.value.pageNo,pageSize:v.value.pageSize,fileNameFuzzy:g.value,filePid:I.value.fileId},o=await c.Request({url:_.loadDataList,showLoading:k,params:t});o&&(v.value=o.data)},D=t=>{v.value.list.forEach(o=>{o.showOp=!1}),t.showOp=!0},O=t=>{t.showOp=!1},F=r(),b=r(),$=t=>{if(t.folderType==1){b.value.openFolder(t);return}if(t.status!=2){c.Message.warning("File is in transcoding, can't preview");return}F.value.showPreview(t,1)},I=r({fileId:0}),E=t=>{const{curFolder:o}=t;I.value=o,k.value=!0,p()},M=t=>{c.Confirm(`You really want to delete【${t.fileName}】？you can still recover it in 10 days from recycle bin`,async()=>{await c.Request({url:_.delFile,params:{fileIdAndUserIds:t.userId+"_"+t.fileId}})&&p()})},P=()=>{d.value.length!=0&&c.Confirm("You really want to delete all these files？All deleted files can be recovered from cycle bin in 10 days",async()=>{await c.Request({url:_.delFile,params:{fileIdAndUserIds:d.value.join(",")}})&&p()})},B=async t=>{let o=await c.Request({url:_.createDownloadUrl+"/"+t.userId+"/"+t.fileId});o&&(window.location.href=_.download+"/"+o.data)};return(t,o)=>{const T=f("el-input"),K=f("el-button"),q=f("Navigation"),N=f("icon"),A=f("Table"),j=f("Preview");return a(),s("div",null,[l("div",Z,[l("div",ee,[l("div",te,[m(T,{clearable:"",placeholder:"search by file name",modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=u=>g.value=u),onKeyup:z(w,["enter"])},{suffix:h(()=>[l("i",{class:"iconfont icon-search",onClick:w})]),_:1},8,["modelValue","onKeyup"])]),l("div",{class:"iconfont icon-refresh",onClick:p}),m(K,{style:{"margin-left":"10px"},type:"danger",disabled:d.value.length==0,onClick:P},{default:h(()=>[oe,R(" multiple_delete ")]),_:1},8,["disabled"])]),m(q,{ref_key:"navigationRef",ref:b,onNavChange:E,adminShow:!0},null,512)]),l("div",le,[m(A,{columns:L,showPagination:!0,dataSource:v.value,fetch:p,initFetch:!1,options:U,onRowSelected:x},{fileName:h(({index:u,row:e})=>[l("div",{class:"file-item",onMouseenter:i=>D(e),onMouseleave:i=>O(e)},[(e.fileType==3||e.fileType==1)&&e.status==2?(a(),C(N,{key:0,cover:e.fileCover,width:32},null,8,["cover"])):(a(),s(V,{key:1},[e.folderType==0?(a(),C(N,{key:0,fileType:e.fileType},null,8,["fileType"])):n("",!0),e.folderType==1?(a(),C(N,{key:1,fileType:0})):n("",!0)],64)),e.showEdit?n("",!0):(a(),s("span",{key:2,class:"file-name",title:e.fileName},[l("span",{onClick:i=>$(e)},S(e.fileName),9,se),e.status==0?(a(),s("span",ne,"Transcoding")):n("",!0),e.status==1?(a(),s("span",ce,"transcoding failed!")):n("",!0)],8,ie)),e.showEdit?(a(),s("div",re,[m(T,{modelValue:e.fileNameReal,"onUpdate:modelValue":i=>e.fileNameReal=i,modelModifiers:{trim:!0},maxLength:190,onKeyup:z(i=>t.saveNameEdit(u),["enter"])},{suffix:h(()=>[R(S(e.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),l("span",{class:H(["iconfont icon-right1",e.fileNameReal?"":"not-allow"]),onClick:i=>t.saveNameEdit(u)},null,10,de),l("span",{class:"iconfont icon-error",onClick:i=>t.cancelNameEdit(u)},null,8,pe)])):n("",!0),l("span",ue,[e.showOp&&e.fileId?(a(),s(V,{key:0},[e.folderType==0?(a(),s("span",{key:0,class:"iconfont icon-download",onClick:i=>B(e)},"Download",8,fe)):n("",!0),l("span",{class:"iconfont icon-del",onClick:i=>M(e)},"Delete",8,me)],64)):n("",!0)])],40,ae)]),fileSize:h(({index:u,row:e})=>[e.fileSize?(a(),s("span",_e,S(J(c).Utils.size2Str(e.fileSize)),1)):n("",!0)]),_:1},8,["dataSource"])]),m(j,{ref_key:"previewRef",ref:F},null,512)])}}},je=W(ve,[["__scopeId","data-v-d065de28"]]);export{je as default};
