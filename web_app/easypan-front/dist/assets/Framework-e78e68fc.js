import{j as G,r as m,ag as v,o as l,c as p,a as s,F as j,V as n,P as d,T as E,a3 as Y,U as z,n as Z,a8 as H,O as B,S as N,J as T,K as X,u as O,bh as ee,bf as se,w as ie,R as ue}from"./@vue-7298a6f3.js";import{u as K,b as Q}from"./vue-router-128bc7ad.js";import{S as ce}from"./spark-md5-18b273be.js";import{_ as ae}from"./index-29e2e257.js";import"./aplayer-d80f7f58.js";import"./element-plus-857d32b3.js";import"./lodash-es-36eb724a.js";import"./@vueuse-740eda15.js";import"./@element-plus-925c7e21.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-c95324ad.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-85da7166.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-d10d3e5d.js";import"./vue-cookies-9b55b892.js";import"./@highlightjs-b388fc70.js";import"./highlight.js-cc51af62.js";import"./axios-4a70c6fc.js";import"./docx-preview-b41ea745.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-acd0b5a4.js";import"./vue-9ac0364e.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const de={class:"avatar-upload"},pe={class:"avatar-show"},_e=["src"],me=["src"],ve=["src"],fe={class:"select-btn"},he={__name:"AvatarUpload",props:{modelValue:{type:Object,default:null}},setup(w,{emit:g}){G(),K(),Q(),m("");const $=m(null),P=async c=>{c=c.file;let e=new FileReader;e.readAsDataURL(c),e.onload=({target:y})=>{$.value=y.result},g("update:modelValue",c)};return(c,e)=>{const y=v("el-button"),D=v("el-upload");return l(),p("div",de,[s("div",pe,[$.value?(l(),p("img",{key:0,src:$.value},null,8,_e)):(l(),p(j,{key:1},[w.modelValue&&w.modelValue.qqAvatar?(l(),p("img",{key:0,src:`${w.modelValue.qqAvatar}`},null,8,me)):(l(),p("img",{key:1,src:`/api/getAvatar/${w.modelValue.userId}`},null,8,ve))],64))]),s("div",fe,[n(D,{name:"file","show-file-list":!1,accept:".png,.PNG,.jpg,.JPG,.jpeg,.JPEG,.gif,.GIF,.bmp,.BMP",multiple:!1,"http-request":P},{default:d(()=>[n(y,{type:"primary"},{default:d(()=>[E("选择")]),_:1})]),_:1})])])}}},we={__name:"UpdateAvatar",emits:["updateAvatar"],setup(w,{expose:g,emit:$}){const{proxy:P}=G();K(),Q();const c={updateUserAvatar:"updateUserAvatar"},e=m({}),y=m();g({show:U=>{e.value=Object.assign({},U),e.value.avatar={userId:U.userId,qqAvatar:U.avatar},R.value.show=!0}});const R=m({show:!1,title:"change avatar",buttons:[{type:"primary",text:"yes",click:U=>{V()}}]}),V=async()=>{if(!(e.value.avatar instanceof File)){R.value.show=!1;return}if(!await P.Request({url:c.updateUserAvatar,params:{avatar:e.value.avatar}}))return;R.value.show=!1;const r=P.VueCookies.get("userInfo");delete r.avatar,P.VueCookies.set("userInfo",r,0),$("updateAvatar")};return(U,r)=>{const _=v("el-form-item"),f=v("el-form"),F=v("Dialog");return l(),p("div",null,[n(F,{show:R.value.show,title:R.value.title,buttons:R.value.buttons,width:"500px",showCancel:!0,onClose:r[2]||(r[2]=o=>R.value.show=!1)},{default:d(()=>[n(f,{model:e.value,ref_key:"formDataRef",ref:y,"label-width":"80px",onSubmit:r[1]||(r[1]=Y(()=>{},["prevent"]))},{default:d(()=>[n(_,{label:"nickName",prop:""},{default:d(()=>[E(z(e.value.nickName),1)]),_:1}),n(_,{label:"Avatar",prop:""},{default:d(()=>[n(he,{modelValue:e.value.avatar,"onUpdate:modelValue":r[0]||(r[0]=o=>e.value.avatar=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},ge=s("span",{class:"iconfont icon-password"},null,-1),ye=s("span",{class:"iconfont icon-password"},null,-1),ke={__name:"UpdatePassword",setup(w,{expose:g}){const{proxy:$}=G(),P={updatePassword:"updatePassword"},c=m({}),e=m(),y=(r,_,f)=>{_!==c.value.rePassword?f(new Error(r.message)):f()},D={password:[{required:!0,message:"please write your password"},{validator:$.Verify.password,message:"password can only consist of numbers, letters, special characters. 8-18 digits"}],rePassword:[{required:!0,message:"please write your password again"},{validator:y,message:"two passwords are not the same"}]};g({show:()=>{V.value.show=!0,Z(()=>{e.value.resetFields(),c.value={}})}});const V=m({show:!1,title:"change password",buttons:[{type:"primary",text:"yes",click:r=>{U()}}]}),U=async()=>{e.value.validate(async r=>{!r||!await $.Request({url:P.updatePassword,params:{password:c.value.password}})||(V.value.show=!1,$.Message.success("reset password success"))})};return(r,_)=>{const f=v("el-input"),F=v("el-form-item"),o=v("el-form"),i=v("Dialog");return l(),p("div",null,[n(i,{show:V.value.show,title:V.value.title,buttons:V.value.buttons,width:"500px",showCancel:!0,onClose:_[3]||(_[3]=t=>V.value.show=!1)},{default:d(()=>[n(o,{model:c.value,rules:D,ref_key:"formDataRef",ref:e,"label-width":"80px",onSubmit:_[2]||(_[2]=Y(()=>{},["prevent"]))},{default:d(()=>[n(F,{label:"new password",prop:"password"},{default:d(()=>[n(f,{type:"password",size:"large",placeholder:"please write your password",modelValue:c.value.password,"onUpdate:modelValue":_[0]||(_[0]=t=>c.value.password=t),"show-password":""},{prefix:d(()=>[ge]),_:1},8,["modelValue"])]),_:1}),n(F,{label:"check password",prop:"rePassword"},{default:d(()=>[n(f,{type:"password",size:"large",placeholder:"please write your password again",modelValue:c.value.rePassword,"onUpdate:modelValue":_[1]||(_[1]=t=>c.value.rePassword=t),"show-password":""},{prefix:d(()=>[ye]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}};const Ce=w=>(ee("data-v-b5e966cc"),w=w(),se(),w),be={class:"uploader-panel"},Se=Ce(()=>s("div",{class:"uploader-title"},[s("span",null,"upload missions"),s("span",{class:"tips"},"（only show current upload mission）")],-1)),xe={class:"file-list"},$e={class:"file-item"},Pe={class:"upload-panel"},Ue={class:"file-name"},Fe={class:"progress"},Ie={class:"upload-status"},Re={key:0,class:"upload-info"},Ve={class:"op"},Ae={class:"op-btn"},ze={key:0},De={key:0},q=1024*512,Ne={__name:"Uploader",emits:["uploadCallback"],setup(w,{expose:g,emit:$}){const{proxy:P}=G(),c={upload:"/file/uploadFile"},e={emptyfile:{value:"emptyfile",desc:"file is null",color:"#F75000",icon:"close"},fail:{value:"fail",desc:"upload failed",color:"#F75000",icon:"close"},init:{value:"init",desc:"scanning",color:"#e6a23c",icon:"clock"},uploading:{value:"uploading",desc:"uploading",color:"#409eff",icon:"upload"},upload_finish:{value:"upload_finish",desc:"upload success",color:"#67c23a",icon:"ok"},upload_seconds:{value:"upload_seconds",desc:"immediate upload",color:"#67c23a",icon:"ok"}},y=m([]),D=m([]);g({addFile:async(o,i)=>{const t={file:o,uid:o.uid,md5Progress:0,md5:null,fileName:o.name,status:e.init.value,uploadSize:0,totalSize:o.size,uploadProgress:0,pause:!1,chunkIndex:0,filePid:i,errorMsg:null};if(y.value.unshift(t),t.totalSize==0){t.status=e.emptyfile.value;return}let C=await f(t);C!=null&&_(C)}});const V=o=>{let i=F(o);i.pause=!1,_(o,i.chunkIndex)},U=o=>{let i=F(o);i.pause=!0},r=(o,i)=>{D.value.push(o),y.value.splice(i,1)},_=async(o,i)=>{i=i||0;let t=F(o);const C=t.file,b=t.totalSize,a=Math.ceil(b/q);for(let S=i;S<a;S++){let A=D.value.indexOf(o);if(A!=-1){D.value.splice(A,1);break}if(t=F(o),t.pause)break;let h=S*q,M=h+q>=b?b:h+q,u=C.slice(h,M),x=await P.Request({url:c.upload,showLoading:!1,dataType:"file",params:{file:u,fileName:C.name,fileMd5:t.md5,chunkIndex:S,chunks:a,fileId:t.fileId,filePid:t.filePid},showError:!1,errorCallback:I=>{t.status=e.fail.value,t.errorMsg=I},uploadProgressCallback:I=>{let L=I.loaded;L>b&&(L=b),t.uploadSize=S*q+L,t.uploadProgress=Math.floor(t.uploadSize/b*100)}});if(x==null)break;if(t.fileId=x.data.fileId,t.status=e[x.data.status].value,t.chunkIndex=S,x.data.status==e.upload_seconds.value||x.data.status==e.upload_finish.value){t.uploadProgress=100,$("uploadCallback");break}}},f=o=>{let i=o.file,t=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,C=Math.ceil(i.size/q),b=0,a=new ce.ArrayBuffer,S=new FileReader;new Date().getTime();let A=()=>{let h=b*q,M=h+q>=i.size?i.size:h+q;S.readAsArrayBuffer(t.call(i,h,M))};return A(),new Promise((h,M)=>{let u=F(i.uid);S.onload=x=>{if(a.append(x.target.result),b++,b<C){let I=Math.floor(b/C*100);u.md5Progress=I,A()}else{let I=a.end();a.destroy(),u.md5Progress=100,u.status=e.uploading.value,u.md5=I,h(o.uid)}},S.onerror=()=>{u.md5Progress=-1,u.status=e.fail.value,h(o.uid)}}).catch(h=>null)},F=o=>y.value.find(t=>t.file.uid===o);return(o,i)=>{const t=v("el-progress"),C=v("icon"),b=v("NoData");return l(),p("div",be,[Se,s("div",xe,[(l(!0),p(j,null,H(y.value,(a,S)=>(l(),p("div",$e,[s("div",Pe,[s("div",Ue,z(a.fileName),1),s("div",Fe,[a.status==e.uploading.value||a.status==e.upload_seconds.value||a.status==e.upload_finish.value?(l(),B(t,{key:0,percentage:a.uploadProgress},null,8,["percentage"])):N("",!0)]),s("div",Ie,[s("span",{class:T(["iconfont","icon-"+e[a.status].icon]),style:X({color:e[a.status].color})},null,6),s("span",{class:"status",style:X({color:e[a.status].color})},z(a.status=="fail"?a.errorMsg:e[a.status].desc),5),a.status==e.uploading.value?(l(),p("span",Re,z(O(P).Utils.size2Str(a.uploadSize))+"/"+z(O(P).Utils.size2Str(a.totalSize)),1)):N("",!0)])]),s("div",Ve,[a.status==e.init.value?(l(),B(t,{key:0,type:"circle",width:50,percentage:a.md5Progress},null,8,["percentage"])):N("",!0),s("div",Ae,[a.status===e.uploading.value?(l(),p("span",ze,[a.pause?(l(),B(C,{key:0,width:28,class:"btn-item",iconName:"upload",title:"upload",onClick:A=>V(a.uid)},null,8,["onClick"])):(l(),B(C,{key:1,width:28,class:"btn-item",iconName:"pause",title:"stop",onClick:A=>U(a.uid)},null,8,["onClick"]))])):N("",!0),a.status!=e.init.value&&a.status!=e.upload_finish.value&&a.status!=e.upload_seconds.value?(l(),B(C,{key:1,width:28,class:"del btn-item",iconName:"del",title:"delete",onClick:A=>r(a.uid,S)},null,8,["onClick"])):N("",!0),a.status==e.upload_finish.value||a.status==e.upload_seconds.value?(l(),B(C,{key:2,width:28,class:"clean btn-item",iconName:"clean",title:"clean",onClick:A=>r(a.uid,S)},null,8,["onClick"])):N("",!0)])])]))),256)),y.value.length==0?(l(),p("div",De,[n(b,{msg:"no uploading mission"})])):N("",!0)])])}}},Me=ae(Ne,[["__scopeId","data-v-b5e966cc"]]);const W=w=>(ee("data-v-4558e640"),w=w(),se(),w),qe={class:"framework"},Le={class:"header"},Be=W(()=>s("div",{class:"logo"},[s("span",{class:"iconfont icon-pan"}),s("span",{class:"name"},"Nathan Drive")],-1)),Te={class:"right-panel"},je=W(()=>s("span",{class:"iconfont icon-transfer"},null,-1)),Ee={class:"user-info"},Ge={class:"avatar"},Oe={class:"nick-name"},Je={class:"body"},He={class:"left-sider"},Ke={class:"menu-list"},Qe=["onClick"],We={class:"text"},Xe={class:"menu-sub-list"},Ye=["onClick"],Ze={class:"text"},es={key:0,class:"tips"},ss={class:"space-info"},as=W(()=>s("div",null,"storage usage",-1)),ts={class:"percent"},os={class:"space-use"},ls={class:"use"},ns={class:"body-content"},rs={__name:"Framework",setup(w){const{proxy:g}=G(),$=K(),P=Q(),c={getUseSpace:"/getUseSpace",logout:"/logout"},e=m(!1),y=m(),D=u=>{const{file:x,filePid:I}=u;e.value=!0,y.value.addFile(x,I)},R=m(),V=()=>{Z(()=>{R.value.reload(),M()})},U=m(0),r=m(g.VueCookies.get("userInfo")),_=[{icon:"cloude",name:"HomePage",menuCode:"main",path:"/main/all",allShow:!0,children:[{icon:"all",name:"all",category:"all",path:"/main/all"},{icon:"video",name:"video",category:"video",path:"/main/video"},{icon:"music",name:"music",category:"music",path:"/main/music"},{icon:"image",name:"image",category:"image",path:"/main/image"},{icon:"doc",name:"doc",category:"doc",path:"/main/doc"},{icon:"more",name:"more",category:"others",path:"/main/others"}]},{path:"/myshare",icon:"share",name:"myshare",menuCode:"share",allShow:!0,children:[{name:"share record",path:"/myshare"}]},{path:"/recycle",icon:"del",name:"recycle",menuCode:"recycle",tips:"recycle keep your deleted files for 10 days",allShow:!0,children:[{name:"deleted file",path:"/recycle"}]},{path:"/settings/fileList",icon:"settings",name:"settings",menuCode:"settings",allShow:!1,children:[{name:"user file",path:"/settings/fileList"},{name:"user manage",path:"/settings/userList"},{path:"/settings/sysSetting",name:"sysSetting"}]}],f=m({}),F=m(),o=u=>{!u.path||u.menuCode==f.value.menuCode||$.push(u.path)},i=(u,x)=>{const I=_.find(L=>L.menuCode===u);f.value=I,F.value=x};ie(()=>P,(u,x)=>{u.meta.menuCode&&i(u.meta.menuCode,u.path)},{immediate:!0,deep:!0});const t=m(),C=()=>{t.value.show(r.value)},b=()=>{r.value=g.VueCookies.get("userInfo"),U.value=new Date().getTime()},a=m(),S=()=>{a.value.show()},A=()=>{g.Confirm("do you really want to delete and exit?",async()=>{await g.Request({url:c.logout})&&(g.VueCookies.remove("userInfo"),$.push("/login"))})},h=m({useSpace:0,totalSpace:1}),M=async()=>{let u=await g.Request({url:c.getUseSpace,showLoading:!1});u&&(h.value=u.data)};return M(),(u,x)=>{const I=v("el-popover"),L=v("Avatar"),J=v("el-dropdown-item"),te=v("el-dropdown-menu"),oe=v("el-dropdown"),le=v("el-progress"),ne=v("router-view");return l(),p("div",qe,[s("div",Le,[Be,s("div",Te,[n(I,{width:800,trigger:"click",visible:e.value,"onUpdate:visible":x[0]||(x[0]=k=>e.value=k),offset:20,transition:"none","hide-after":0,"popper-style":{padding:"0px"}},{reference:d(()=>[je]),default:d(()=>[n(Me,{ref_key:"uploaderRef",ref:y,onUploadCallback:V},null,512)]),_:1},8,["visible"]),n(oe,null,{dropdown:d(()=>[n(te,null,{default:d(()=>[n(J,{onClick:C},{default:d(()=>[E(" change avatar ")]),_:1}),n(J,{onClick:S},{default:d(()=>[E(" change password ")]),_:1}),n(J,{onClick:A},{default:d(()=>[E(" exit ")]),_:1})]),_:1})]),default:d(()=>[s("div",Ee,[s("div",Ge,[n(L,{userId:r.value.userId,avatar:r.value.avatar,timestamp:U.value,width:46},null,8,["userId","avatar","timestamp"])]),s("span",Oe,z(r.value.nickName),1)])]),_:1})])]),s("div",Je,[s("div",He,[s("div",Ke,[(l(),p(j,null,H(_,k=>(l(),p(j,null,[k.allShow||!k.allShow&&r.value.admin?(l(),p("div",{key:0,onClick:re=>o(k),class:T(["menu-item",k.menuCode==f.value.menuCode?"active":""])},[s("div",{class:T(["iconfont","icon-"+k.icon])},null,2),s("div",We,z(k.name),1)],10,Qe)):N("",!0)],64))),64))]),s("div",Xe,[(l(!0),p(j,null,H(f.value.children,k=>(l(),p("div",{onClick:re=>o(k),class:T(["menu-item-sub",F.value==k.path?"active":""])},[k.icon?(l(),p("span",{key:0,class:T(["iconfont","icon-"+k.icon])},null,2)):N("",!0),s("span",Ze,z(k.name),1)],10,Ye))),256)),f.value&&f.value.tips?(l(),p("div",es,z(f.value.tips),1)):N("",!0),s("div",ss,[as,s("div",ts,[n(le,{percentage:Math.floor(h.value.useSpace/h.value.totalSpace*1e4)/100,color:"#409eff"},null,8,["percentage"])]),s("div",os,[s("div",ls,z(O(g).Utils.size2Str(h.value.useSpace))+"/ "+z(O(g).Utils.size2Str(h.value.totalSpace)),1),s("div",{class:"iconfont icon-refresh",onClick:M})])])])]),s("div",ns,[n(ne,null,{default:d(({Component:k})=>[(l(),B(ue(k),{onAddFile:D,ref_key:"routerViewRef",ref:R,onReload:M},null,544))]),_:1})])]),n(we,{ref_key:"updateAvatarRef",ref:t,onUpdateAvatar:b},null,512),n(ke,{ref_key:"updatePasswordRef",ref:a},null,512)])}}},Ms=ae(rs,[["__scopeId","data-v-4558e640"]]);export{Ms as default};
